generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Employee {
  id          Int          @id @default(autoincrement())
  username    String       @unique
  password    String
  fullName    String
  email       String?      @unique
  position    String?
  phone       String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  assignments Assignment[]
  notifications Notification[]
}

model Manager {
  id          Int          @id @default(autoincrement())
  username    String       @unique
  password    String
  fullName    String
  phone       String?
  email       String?      @unique
  position    String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  assignments Assignment[]
  notifications ManagerNotification[]
}

model Candidate {
  id          Int          @id @default(autoincrement())
  name        String
  phone       String       @unique
  age         Int?
  address     String?
  company     String?
  position    String?
  education   String?
  uploadBatch String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  assignments Assignment[]
  callLogs    CallLog[]

  @@index([phone])
  @@index([uploadBatch])
}

// ğŸ”¥ Ø¬Ø¯ÙˆÙ„ History - Ù„Ø§ ÙŠÙØ­Ø°Ù Ø£Ø¨Ø¯Ø§Ù‹
model CandidateHistory {
  id          Int       @id @default(autoincrement())
  name        String
  phone       String    
  age         Int?
  address     String?
  company     String?
  position    String?
  education   String?
  uploadBatch String?
  
  // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©
  source      String?   // Ù…Ù† Ø£ÙŠÙ† Ø¬Ø§Ø¡ (upload, manual, etc)
  uploadedBy  String?   // Ù…Ù† Ø±ÙØ¹Ù‡
  isActive    Boolean   @default(true) // Ù‡Ù„ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Candidate Ø­Ø§Ù„ÙŠØ§Ù‹
  deletedAt   DateTime? // Ù…ØªÙ‰ ØªÙ… Ø­Ø°ÙÙ‡ Ù…Ù† Candidate
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([phone])
  @@index([uploadBatch])
  @@index([isActive])
  @@index([createdAt])
}

model Assignment {
  id          Int       @id @default(autoincrement())
  employeeId  Int
  candidateId Int
  managerId   Int?
  assignedAt  DateTime  @default(now())
  completedAt DateTime?
  status      String    @default("pending")
  notes       String?

  employee  Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  candidate Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)
  manager   Manager?  @relation(fields: [managerId], references: [id])

  @@unique([employeeId, candidateId])
  @@index([employeeId])
  @@index([candidateId])
  @@index([managerId])
  @@index([status])
}

model CallLog {
  id          Int       @id @default(autoincrement())
  candidateId Int
  employeeId  Int
  status      String
  notes       String?
  calledAt    DateTime  @default(now())
  
  candidate   Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@index([candidateId])
  @@index([status])
}

model Notification {
  id         Int      @id @default(autoincrement())
  employeeId Int
  type       String
  message    String
  read       Boolean  @default(false)
  createdAt  DateTime @default(now())
  
  employee   Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
}

model ManagerNotification {
  id        Int      @id @default(autoincrement())
  managerId Int
  type      String
  message   String
  read      Boolean  @default(false)
  metadata  String?  @db.Text
  createdAt DateTime @default(now())
  
  manager   Manager  @relation(fields: [managerId], references: [id], onDelete: Cascade)
  
  @@index([managerId])
  @@index([read])
  @@index([type])
}