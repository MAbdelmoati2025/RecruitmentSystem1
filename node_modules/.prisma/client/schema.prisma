// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…ÙˆØ¸Ù
model Employee {
  id       Int     @id @default(autoincrement())
  username String  @unique
  password String
  fullName String
  email    String? @unique
  position String?
  phone    String?

  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  assignments   Assignment[]
  notifications Notification[]
}

// Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø¯ÙŠØ±
model Manager {
  id            Int                   @id @default(autoincrement())
  username      String                @unique
  password      String
  fullName      String
  phone         String?
  email         String?               @unique
  position      String?
  createdAt     DateTime              @default(now())
  updatedAt     DateTime              @updatedAt
  assignments   Assignment[]
  notifications ManagerNotification[] // ğŸ”¥ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ±
}

// Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø±Ø´Ø­
model Candidate {
  id          Int          @id @default(autoincrement())
  name        String
  phone       String       @unique
  age         Int?
  address     String?
  company     String?
  position    String?
  education   String?
  uploadBatch String?
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  assignments Assignment[]
  callLogs    CallLog[]

  @@index([phone])
  @@index([uploadBatch])
}

// Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ¹ÙŠÙŠÙ†
model Assignment {
  id          Int       @id @default(autoincrement())
  employeeId  Int
  candidateId Int
  managerId   Int?
  assignedAt  DateTime  @default(now())
  completedAt DateTime? // ğŸ”¥ ÙˆÙ‚Øª Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©
  status      String    @default("pending")
  notes       String?

  employee  Employee  @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  candidate Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)
  manager   Manager?  @relation(fields: [managerId], references: [id])

  @@unique([employeeId, candidateId])
  @@index([employeeId])
  @@index([candidateId])
  @@index([managerId])
  @@index([status])
}

// Ù†Ù…ÙˆØ°Ø¬ Ø³Ø¬Ù„ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§Øª
model CallLog {
  id          Int      @id @default(autoincrement())
  candidateId Int
  employeeId  Int
  status      String
  notes       String?
  calledAt    DateTime @default(now())

  candidate Candidate @relation(fields: [candidateId], references: [id], onDelete: Cascade)

  @@index([candidateId])
  @@index([status])
}

// Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
model Notification {
  id         Int      @id @default(autoincrement())
  employeeId Int
  type       String
  message    String
  read       Boolean  @default(false)
  createdAt  DateTime @default(now())

  employee Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
}

// ğŸ”¥ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø¯ÙŠØ± (Ø¬Ø¯ÙŠØ¯)
model ManagerNotification {
  id        Int      @id @default(autoincrement())
  managerId Int
  type      String
  message   String
  read      Boolean  @default(false)
  metadata  String?  @db.Text
  createdAt DateTime @default(now())

  manager Manager @relation(fields: [managerId], references: [id], onDelete: Cascade)

  @@index([managerId])
  @@index([read])
  @@index([type])
}
